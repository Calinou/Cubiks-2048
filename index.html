<meta content="text/html;charset=utf-8" http-equiv="Content-Type">

<html>
<head>
    <title> Cube-2048 </title>
</head>

<body>
  <!-- <h1 style="font-size :80px ; text-align:center"> Cube-2048</h1>     -->
<script src="./libs/jquery.min.js"> </script>
<script src="./libs/three.js"> </script>
<script src="./libs/keyboard.js"></script>
<script src="./js/cube.js"></script>
<script src="./js/gravity.js"></script>
<script src="./js/Game.js"></script>
<script src="./js/rotation_anim.js"></script>

<script>
    var renderer, scene, camera, cube_group;
    var cube_size = 3;
    var CUBE2048;
    var X_axis = new THREE.Vector3(1, 0, 0);
    var Y_axis = new THREE.Vector3(0, 1, 0);
    var Z_axis = new THREE.Vector3(0, 0, 1);

    var textures = {
        2: THREE.ImageUtils.loadTexture('./Textures/Texture_2.gif'),
        4: THREE.ImageUtils.loadTexture('./Textures/Texture_4.gif'),
        8: THREE.ImageUtils.loadTexture('./Textures/Texture_8.gif'),
        16: THREE.ImageUtils.loadTexture('./Textures/Texture_16.gif'),
        32: THREE.ImageUtils.loadTexture('./Textures/Texture_32.gif')
    }

    var clock = new THREE.Clock();

    init();
    
    animate();
    
    function init() {

        div = document.createElement('div');
        document.body.appendChild(div);
    
	    scene = new THREE.Scene();
        // The plane platform.

        var plane = new THREE.PlaneGeometry(1000, 1000, 100, 100);
        var plane_mat = new THREE.MeshBasicMaterial({ color: 0x708090, transparent: true, opacity: 0.4 });
        var plane_mesh = new THREE.Mesh(plane, plane_mat);
        scene.add(plane_mesh);
        plane_mesh.position.set(50, -1000 / cube_size, 0);
        plane_mesh.rotation.x -= 1.5;

        // Cameras

        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 10000);
        camera.position.set(50, 50 + (40 * cube_size), 50 * cube_size);
        camera.lookAt(new THREE.Vector3(50, 50, 0));
        scene.add(camera);


        // Lights

        var spotLight = new THREE.SpotLight(0xffffff);
        spotLight.position.set(300, 300, 300);
        scene.add(spotLight);
        scene.add(new THREE.AmbientLight(0xffffff));

        // Geometries
        cube_group = new THREE.Object3D();
        cube_group.position.set(50, 50, 0);

        // Refresh the game.

        CUBE2048 = new GAME(3);        

        scene.add(cube_group);

        // Renderer

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth - 20, window.innerHeight - 20);
        renderer.setClearColor(0xffffff);

        div.appendChild(renderer.domElement);        

        // Axis

        var axisHelper = new THREE.AxisHelper(5);
        scene.add(axisHelper);

        bind_keyboard_keys();
    };


    function animate() {
        requestAnimationFrame(animate);

        if (rotation_animation.is_animating()) {
            if (rotation_animation.rotate_x) {
                rotateAroundWorldAxis(cube_group, X_axis, rotation_animation.rotation_direction * rotation_animation.get_offset());

                if (--rotation_animation.animation_residue == 0) {
                    rotation_animation.rotate_x = false;
                }
            }
            else if (rotation_animation.rotate_y) {
                rotateAroundWorldAxis(cube_group, Y_axis, rotation_animation.rotation_direction * rotation_animation.get_offset());

                if (--rotation_animation.animation_residue == 0) {
                    rotation_animation.rotate_y = false;
                }
            }
            else if (rotation_animation.rotate_z) {
                rotateAroundWorldAxis(cube_group, Z_axis, rotation_animation.rotation_direction * rotation_animation.get_offset());

                if (--rotation_animation.animation_residue == 0) {
                    rotation_animation.rotate_z = false;
                }
            }
        }

        // For the inner blocks..
        THREE.AnimationHandler.update(clock.getDelta());

        renderer.render(scene, camera);
    };

function release() {

    var len = cube_group.children.length;
    for (var i = 0 ; i < len ; i++ )
        cube_group.remove(cube_group.children[0]);

    len = scene.children.length;
    for (var i = 0 ; i < len; i++)
        scene.remove(scene.children[0]);

    renderer.render(scene, camera);

    delete CUBE2048;
    delete cube_group;
    delete scene;
    delete camera;
    delete renderer;
    $("div").remove();

    KeyboardJS.clear('down');
    KeyboardJS.clear('up');
    KeyboardJS.clear('left');
    KeyboardJS.clear('right');

    alert("Game Over!");

    init();
 };

 </script>


</body>
</html>